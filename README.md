# ADC Baremetal Demo

Demonstration of ADC polling on the STM32L476RG (Nucleo) with signals generated by an Analog Discovery 2 (AD2).

Reads analog input on PA0 (Arduino A0) via ADC1 Channel 5
Outputs readings to Serial as byte stream.

In this demo, you will flash the Nucleo with a program that samples data at various sample rates and observe their effects. This repo also contains MATLAB scripts to collect and display sampled data from the Nucleo - the Nucleo will transmit sampled data to the PC via UART.

## Materials

- Analog Discovery 2 hardware and Waveforms software
- MATLAB software
- STM32F476RG Nucleo hardware, VS Code with PlatformIO extension

## Software Setup

Both the embedded system toolchain and MATLAB scripts can be called from VS Code (with the appropriate extensions). This repo provides VS Code extension recommendations that can be found in `.vscode/extensions.json`.

The PlatformIO extension will be used to build and flash code to the Nucleo.

The MATLAB extension will allow you to open a headless MATLAB command window as a terminal in VS Code. You can then call the scripts from the terminal and the MATLAB engine will handle the rest. MATLAB must be installed on your computer.

The Markdown Preview extension is optional - it opens a rendered markdown file when clicking on markdown source. Otherwise you must right-click markdown files and select 'Preview'.

## Repository Files

- `scenarios.md` A demo manual on configuring hardware to illustrate different consequences of data acquisition.

### MATLAB

- `readUART_simple.m` A function that reads the serial stream with the frame [0xAA 0xAA LSB MSB] for one 16-bit value. This demonstrates the basic processing of a serial stream.
    
    You can pass arguments to the function. The first is the COM port (string) and the second is baud rate (integer).

- `plotUART.m` An advanced real-time plotting function. Can be configured to read the 16-bit value and an optional timestamp. Additional options can be used to show raw samples, associate samples with timestamps, or assume sample period based on sample rate. See `plotUART.m` source code for a full list of options.

### Digilent Waveforms

- `waveforms.dwf2work` A workspace file that will preconfigure Waveforms with scope and waveform generator settings.

### PlatformIO

- `platformio.ini` The build configuration file for PlatformIO. This file sets the build flags (no optimizations) and serial monitor settings. Also includes external libraries automatically.

- `/src/main.cpp` The main source code for the embedded system. Uses timer interrupts to periodically sample data with the ADC and sends data via UART to the PC.

- `/.vscode` Contains VS Code config files and recommended extensions for you to install.

- `/.pio` Directory for build artifacts.

## Flashing the Nucleo

This repo contains a `platformio.ini` file which will be picked up by your PlatformIO extension. PlatformIO will then configure the project dependencies. Once configured, you can flash the Nucleo.

In the PlatformIO settings of the Activity Bar (left), click the `Upload` task to build and flash the program to the Nucleo.